<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö—Ä–æ—Ç–æ –ë–∏—Ç–≤–∞</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="game-container">
    <h1>–ö—Ä–æ—Ç–æ –ë–∏—Ç–≤–∞ üï≥Ô∏è</h1>

    <div class="player-stats">
      <p>–ú–æ—Ä–∫–æ–≤–∫–∏: <span id="carrots">0</span></p>
      <p>–£—Ä–æ–Ω: <span id="damage">1</span></p>
      <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
    </div>

    <div class="krot-click" id="krot">
      <img src="assets/krot.png" alt="–ö—Ä–æ—Ç" />
    </div>

    <div class="upgrade-panel">
      <button id="btn-damage" class="upgrade-btn">–£–≤–µ–ª–∏—á–∏—Ç—å —É—Ä–æ–Ω</button>
      <button id="btn-auto" class="upgrade-btn">–ê–≤—Ç–æ-–∫—Ä–æ—Ç (50)</button>
    </div>

    <div class="leaderboard" id="leaderboard" style="display: none;">
      <h3>üèÜ –õ–∏–¥–µ—Ä—ã</h3>
      <ul id="leader-list">
        <li>1. –ö—Ä–æ—Ç-–±–æ–µ—Ü ‚Äî 500 –º–æ—Ä–∫–æ–≤–æ–∫</li>
      </ul>
    </div>

    <div class="message" id="message"></div>
  </div>

  <script>
    // === –ò–≥—Ä–æ–∫ ===
    let player = {
      carrots: 0,
      damage: 1,
      autoClick: false,
      autoClickLevel: 0,
      level: 1,
      upgrades: { damage: 0, auto: 0 }
    };

    const $ = id => document.getElementById(id);

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function loadGame() {
      const saved = localStorage.getItem('krotobitva');
      if (saved) Object.assign(player, JSON.parse(saved));
      updateUI();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    function saveGame() {
      localStorage.setItem('krotobitva', JSON.stringify(player));
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateUI() {
      $('carrots').textContent = Math.floor(player.carrots);
      $('damage').textContent = player.damage;
      $('level').textContent = player.level;
      $('btn-damage').disabled = player.carrots < getDamageCost();
      $('btn-auto').disabled = player.carrots < getAutoCost();
    }

    function getDamageCost() {
      return 5 + player.upgrades.damage * 10;
    }

    function getAutoCost() {
      return 50 + player.upgrades.auto * 100;
    }

    // –ó–≤—É–∫–∏
    const soundClick = new Audio('assets/click.mp3');
    const soundUpgrade = new Audio('assets/upgrade.mp3');
    soundClick.volume = 0.3;
    soundUpgrade.volume = 0.5;

    // –ö–ª–∏–∫ –ø–æ –∫—Ä–æ—Ç—É
    $('krot').addEventListener('click', () => {
      player.carrots += player.damage;
      player.level = Math.floor(Math.log2(player.carrots + 1)) + 1;

      // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
      const click = document.createElement('div');
      click.className = 'click-effect';
      click.textContent = `-${player.damage}`;
      click.style.left = `${event.clientX - 50}px`;
      click.style.top = `${event.clientY - 100}px`;
      document.body.appendChild(click);
      setTimeout(() => click.remove(), 1000);

      // –ó–≤—É–∫
      soundClick.currentTime = 0;
      soundClick.play();

      updateUI();
      saveGame();
    });

    // –£–ª—É—á—à–µ–Ω–∏–µ —É—Ä–æ–Ω–∞
    $('btn-damage').addEventListener('click', () => {
      const cost = getDamageCost();
      if (player.carrots >= cost) {
        player.carrots -= cost;
        player.damage += 1;
        player.upgrades.damage++;
        soundUpgrade.currentTime = 0;
        soundUpgrade.play();
        showMsg(`+1 —É—Ä–æ–Ω! üí™`);
        updateUI();
        saveGame();
      }
    });

    // –ê–≤—Ç–æ–∫–ª–∏–∫
    $('btn-auto').addEventListener('click', () => {
      const cost = getAutoCost();
      if (player.carrots >= cost) {
        player.carrots -= cost;
        player.autoClickLevel++;
        player.upgrades.auto++;
        if (!player.autoClick) {
          player.autoClick = true;
          startAutoClick();
        }
        soundUpgrade.currentTime = 0;
        soundUpgrade.play();
        showMsg(`–ê–≤—Ç–æ-–∫—Ä–æ—Ç –∑–∞–ø—É—â–µ–Ω! ü§ñ`);
        updateUI();
        saveGame();
      }
    });

    function startAutoClick() {
      setInterval(() => {
        if (player.autoClick) {
          player.carrots += player.damage;
          player.level = Math.floor(Math.log2(player.carrots + 1)) + 1;
          updateUI();
          saveGame();
        }
      }, 1000);
    }

    function showMsg(text) {
      const msg = $('message');
      msg.textContent = text;
      setTimeout(() => msg.textContent = '', 1500);
    }

    // Telegram
    if (Telegram.WebApp) {
      Telegram.WebApp.expand();
      Telegram.WebApp.ready();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞
    loadGame();
  </script>
</body>
</html>
